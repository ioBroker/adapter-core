{
  "version": 3,
  "sources": ["../esm/controllerTools.js"],
  "sourcesContent": ["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.commonTools = exports.resolveNamedModule = exports.controllerToolsInternal = exports.controllerCommonModulesInternal = void 0;\nconst path = __importStar(require(\"path\"));\nconst helpers_1 = require(\"./helpers\");\nconst utils = __importStar(require(\"./utils\"));\nfunction resolveControllerTools() {\n    // Attempt 1: Resolve @iobroker/js-controller-common from here - JS-Controller 4.1+\n    let importPath = (0, helpers_1.tryResolvePackage)([\"@iobroker/js-controller-common\"]);\n    if (importPath) {\n        try {\n            exports.controllerCommonModulesInternal = require(importPath);\n            const { tools } = exports.controllerCommonModulesInternal;\n            if (tools)\n                return tools;\n        }\n        catch (_a) {\n            // did not work, continue\n        }\n    }\n    // Attempt 2: Resolve @iobroker/js-controller-common in JS-Controller dir - JS-Controller 4.1+\n    importPath = (0, helpers_1.tryResolvePackage)([\"@iobroker/js-controller-common\"], [path.join(utils.controllerDir, \"node_modules\")]);\n    if (importPath) {\n        try {\n            exports.controllerCommonModulesInternal = require(importPath);\n            const { tools } = exports.controllerCommonModulesInternal;\n            if (tools)\n                return tools;\n        }\n        catch (_b) {\n            // did not work, continue\n        }\n    }\n    // Attempt 3: Legacy resolve - until JS-Controller 4.0\n    importPath = path.join(utils.controllerDir, \"lib\");\n    try {\n        // This was a default export prior to the TS migration\n        const tools = require(path.join(importPath, \"tools\"));\n        if (tools)\n            return tools;\n    }\n    catch (_c) {\n        // did not work, continue\n    }\n    throw new Error(\"Cannot resolve tools module\");\n    //return process.exit(10);\n}\n/** The collection of utility functions in JS-Controller, formerly `lib/tools.js` */\nexports.controllerToolsInternal = resolveControllerTools();\n// Export a subset of the utilties in controllerTools\n/**\n * Resolve a module that is either exported by @iobroker/js-controller-common (new controllers) or located in the controller's `lib` directory (old controllers).\n * @param name - The filename of the module to resolve\n * @param exportName - The name under which the module may be exported. Defaults to `name`.\n */\nfunction resolveNamedModule(name, exportName = name) {\n    // The requested module might be moved to @iobroker/js-controller-common and exported from there\n    if (exports.controllerCommonModulesInternal === null || exports.controllerCommonModulesInternal === void 0 ? void 0 : exports.controllerCommonModulesInternal[exportName])\n        return exports.controllerCommonModulesInternal[exportName];\n    // Otherwise it was not moved yet, or we're dealing with JS-Controller <= 4.0\n    // Attempt 1: JS-Controller 4.1+\n    let importPath = path.join(utils.controllerDir, \"build/lib\", name);\n    try {\n        // This was a default export prior to the TS migration\n        const module = require(importPath);\n        if (module)\n            return module;\n    }\n    catch (_a) {\n        // did not work, continue\n    }\n    // Attempt 2: JS-Controller <= 4.0\n    importPath = path.join(utils.controllerDir, \"lib\", name);\n    try {\n        // This was a default export prior to the TS migration\n        const module = require(importPath);\n        if (module)\n            return module;\n    }\n    catch (_b) {\n        // did not work, continue\n    }\n    throw new Error(`Cannot resolve JS-Controller module ${name}.js`);\n    //return process.exit(10);\n}\nexports.resolveNamedModule = resolveNamedModule;\n// TODO: Import types from @iobroker/js-controller-common and iobroker.js-controller\n/**\n * Converts a pattern to match object IDs into a RegEx string that can be used in `new RegExp(...)`\n * @param pattern The pattern to convert\n * @returns The RegEx string\n */\nfunction pattern2RegEx(pattern) {\n    return exports.controllerToolsInternal.pattern2RegEx(pattern);\n}\n/**\n * Finds the adapter directory of a given adapter\n *\n * @param adapter name of the adapter, e.g. hm-rpc\n * @returns path to adapter directory or null if no directory found\n */\nfunction getAdapterDir(adapter) {\n    return exports.controllerToolsInternal.getAdapterDir(adapter);\n}\n/**\n * Get list of all installed adapters and controller version on this host\n * @param hostJsControllerVersion Version of the running js-controller, will be included in the returned information if provided\n * @returns object containing information about installed host\n */\nfunction getInstalledInfo(hostJsControllerVersion) {\n    return exports.controllerToolsInternal.getInstalledInfo(hostJsControllerVersion);\n}\n/**\n * Checks if we are running inside a docker container\n */\nfunction isDocker() {\n    return exports.controllerToolsInternal.isDocker();\n}\n/**\n * Checks if given ip address is matching ipv4 or ipv6 localhost\n * @param ip ipv4 or ipv6 address\n */\nfunction isLocalAddress(ip) {\n    return exports.controllerToolsInternal.isLocalAddress(ip);\n}\n/**\n * Checks if given ip address is matching ipv4 or ipv6 \"listen all\" address\n * @param ip ipv4 or ipv6 address\n */\nfunction isListenAllAddress(ip) {\n    return exports.controllerToolsInternal.isListenAllAddress(ip);\n}\n/**\n * Retrieve the localhost address according to the configured DNS resolution strategy\n */\nfunction getLocalAddress() {\n    return exports.controllerToolsInternal.getLocalAddress();\n}\n/**\n * Get the ip to listen to all addresses according to configured DNS resolution strategy\n */\nfunction getListenAllAddress() {\n    return exports.controllerToolsInternal.getListenAllAddress();\n}\nexports.commonTools = {\n    pattern2RegEx,\n    getAdapterDir,\n    getInstalledInfo,\n    isDocker,\n    getLocalAddress,\n    getListenAllAddress,\n    isLocalAddress,\n    isListenAllAddress,\n    // TODO: Add more methods from lib/tools.js as needed\n    password: resolveNamedModule(\"password\"),\n    /** @deprecated use @iobroker/webserver */\n    letsEncrypt: resolveNamedModule(\"letsencrypt\"),\n    session: resolveNamedModule(\"session\"),\n    zipFiles: resolveNamedModule(\"zipFiles\"),\n    // TODO: expose more (internal) controller modules as needed\n};\n"],
  "mappings": "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",
  "names": ["module"]
}
