{
  "version": 3,
  "sources": ["../esm/utils.js"],
  "sourcesContent": ["\"use strict\";\n/* eslint-disable @typescript-eslint/no-var-requires */\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar _a;\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Adapter = exports.adapter = exports.getConfig = exports.controllerDir = void 0;\nconst fs = __importStar(require(\"fs\"));\nconst path = __importStar(require(\"path\"));\nconst helpers_1 = require(\"./helpers\");\n/**\n * Resolves the root directory of JS-Controller and returns it or exits the process\n * @param isInstall Whether the adapter is run in \"install\" mode or if it should execute normally\n */\nfunction getControllerDir(isInstall) {\n    // Find the js-controller location\n    const possibilities = [\"iobroker.js-controller\", \"ioBroker.js-controller\"];\n    // First try to let Node.js resolve the package by itself\n    let controllerDir = (0, helpers_1.tryResolvePackage)(possibilities);\n    // Apparently, checking vs null/undefined may miss the odd case of controllerPath being \"\"\n    // Thus we check for falsyness, which includes failing on an empty path\n    if (controllerDir)\n        return controllerDir;\n    // As a fallback solution, we walk up the directory tree until we reach the root or find js-controller\n    controllerDir = (0, helpers_1.scanForPackage)(possibilities);\n    if (controllerDir)\n        return controllerDir;\n    if (!isInstall) {\n        console.log(\"Cannot find js-controller\");\n        return process.exit(10);\n    }\n    else {\n        return process.exit();\n    }\n}\n/** The root directory of JS-Controller */\nexports.controllerDir = getControllerDir(!!((_a = process === null || process === void 0 ? void 0 : process.argv) === null || _a === void 0 ? void 0 : _a.includes(\"--install\")));\nfunction resolveAdapterConstructor() {\n    // Attempt 1: Resolve @iobroker/js-controller-adapter from here - JS-Controller 4.1+\n    let adapterPath = (0, helpers_1.tryResolvePackage)([\"@iobroker/js-controller-adapter\"]);\n    if (adapterPath) {\n        try {\n            const { Adapter } = require(adapterPath);\n            if (Adapter)\n                return Adapter;\n        }\n        catch (_a) {\n            // did not work, continue\n        }\n    }\n    // Attempt 2: Resolve @iobroker/js-controller-adapter in JS-Controller dir - JS-Controller 4.1+\n    adapterPath = (0, helpers_1.tryResolvePackage)([\"@iobroker/js-controller-adapter\"], [path.join(exports.controllerDir, \"node_modules\")]);\n    if (adapterPath) {\n        try {\n            const { Adapter } = require(adapterPath);\n            if (Adapter)\n                return Adapter;\n        }\n        catch (_b) {\n            // did not work, continue\n        }\n    }\n    // Attempt 3: JS-Controller 6+ with adapter stub\n    adapterPath = path.join(exports.controllerDir, \"build/cjs/lib/adapter.js\");\n    try {\n        // This was a default export prior to the TS migration\n        const Adapter = require(adapterPath);\n        if (Adapter)\n            return Adapter;\n    }\n    catch (_c) {\n        // did not work, continue\n    }\n    // Attempt 4: JS-Controller 4.1+ with adapter stub\n    adapterPath = path.join(exports.controllerDir, \"build/lib/adapter.js\");\n    try {\n        // This was a default export prior to the TS migration\n        const Adapter = require(adapterPath);\n        if (Adapter)\n            return Adapter;\n    }\n    catch (_d) {\n        // did not work, continue\n    }\n    // Attempt 5: Legacy resolve - until JS-Controller 4.0\n    adapterPath = path.join(exports.controllerDir, \"lib/adapter.js\");\n    try {\n        // This was a default export prior to the TS migration\n        const Adapter = require(adapterPath);\n        if (Adapter)\n            return Adapter;\n    }\n    catch (_e) {\n        // did not work, continue\n    }\n    throw new Error(\"Cannot resolve adapter class\");\n    return process.exit(10);\n}\n/** Reads the configuration file of JS-Controller */\nfunction getConfig() {\n    return JSON.parse(fs.readFileSync(path.join(exports.controllerDir, \"conf/iobroker.json\"), \"utf8\"));\n}\nexports.getConfig = getConfig;\n/** Creates a new adapter instance */\nexports.adapter = resolveAdapterConstructor();\n/** Creates a new adapter instance */\nexports.Adapter = exports.adapter;\n"],
  "mappings": "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",
  "names": ["_a"]
}
