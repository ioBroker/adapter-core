{
  "version": 3,
  "sources": ["../esm/i18n.js"],
  "sourcesContent": ["import { readFileSync, readdirSync, existsSync, statSync } from 'node:fs';\nimport { join } from 'node:path';\nlet language = 'en';\nlet words = null;\n/**\n * Init internationalization\n *\n * @param rootDir The path, where i18n directory is located\n * @param languageOrAdapter The adapter instance or the language to use\n */\nexport async function init(rootDir, languageOrAdapter) {\n    let adapter;\n    if (languageOrAdapter && typeof languageOrAdapter === 'object') {\n        adapter = languageOrAdapter;\n        const systemConfig = await adapter.getForeignObjectAsync('system.config');\n        if (systemConfig?.common.language) {\n            language = systemConfig?.common.language;\n        }\n    }\n    else {\n        language = languageOrAdapter;\n    }\n    let files;\n    if (existsSync(join(rootDir, 'i18n'))) {\n        files = readdirSync(join(rootDir, 'i18n'));\n    }\n    else if (existsSync(join(rootDir, 'lib', 'i18n'))) {\n        // if iobroker.adapter folder and in it exists lib/i18n\n        rootDir = join(rootDir, 'lib');\n        files = readdirSync(join(rootDir, 'i18n'));\n    }\n    else {\n        throw new Error(`Cannot find i18n directory in \"${join(rootDir, 'i18n')}\", \"${join(rootDir, 'lib', 'i18n')}\"`);\n    }\n    words = {};\n    let count = 0;\n    files.forEach((file) => {\n        if (file.endsWith('.json')) {\n            count++;\n            const lang = file.split('.')[0];\n            const wordsForLanguage = JSON.parse(readFileSync(join(rootDir, 'i18n', file)).toString('utf8'));\n            Object.keys(wordsForLanguage).forEach((key) => {\n                if (words) {\n                    if (!words[key]) {\n                        words[key] = {};\n                    }\n                    words[key][lang] = wordsForLanguage[key];\n                }\n            });\n        }\n    });\n    if (!count) {\n        // may be it is an old structure: i18n/lang/translation.json\n        files.forEach((file) => {\n            if ((file.match(/^[a-z]{2}$/) || file === 'zh-cn') && statSync(join(rootDir, 'i18n', file)).isDirectory()) {\n                if (adapter) {\n                    adapter.log.warn('Looks like you use old structure of i18n. ' +\n                        'Please switch to 1i8n/lang.json instead of i18n/lang/translation.json');\n                }\n                const lang = file;\n                if (existsSync(join(rootDir, 'i18n', lang, 'translations.json'))) {\n                    const wordsForLanguage = JSON.parse(readFileSync(join(rootDir, 'i18n', lang, 'translations.json')).toString('utf8'));\n                    Object.keys(wordsForLanguage).forEach((key) => {\n                        if (words) {\n                            if (!words[key]) {\n                                words[key] = {};\n                            }\n                            words[key][lang] = wordsForLanguage[key];\n                        }\n                    });\n                }\n            }\n        });\n    }\n}\n/**\n * Get translation as one string\n *\n * @param key Word to translate\n * @param args Optional parameters to replace %s\n */\nexport function translate(key, ...args) {\n    if (!words) {\n        throw new Error(\"i18n not initialized. Please call 'init(__dirname, adapter)' before\");\n    }\n    let text;\n    if (!words[key]) {\n        text = key;\n    }\n    else {\n        text = words[key][language] || words[key].en || key;\n    }\n    if (args.length) {\n        for (const arg of args) {\n            text = text.replace('%s', arg === null ? 'null' : arg.toString());\n        }\n    }\n    return text;\n}\n/** Alias shortcut for translate function */\nexport const t = translate;\n/**\n * Get translation as ioBroker.Translated object\n *\n * @param key Word to translate\n * @param args Optional parameters to replace %s\n */\nexport function getTranslatedObject(key, ...args) {\n    if (!words) {\n        throw new Error(\"i18n not initialized. Please call 'init(__dirname, adapter)' before\");\n    }\n    if (words[key]) {\n        const word = words[key];\n        if (word.en && word.en.includes('%s')) {\n            const result = {};\n            Object.keys(word).forEach((lang) => {\n                for (const arg of args) {\n                    result[lang] = word[lang].replace('%s', arg === null ? 'null' : arg.toString());\n                }\n            });\n            return result;\n        }\n        return words[key];\n    }\n    return {\n        en: key,\n    };\n}\nexport default {\n    init,\n    translate,\n    getTranslatedObject,\n    t,\n};\n"],
  "mappings": "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",
  "names": []
}
